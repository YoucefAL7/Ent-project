<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 900px; margin: auto; background: #f8f9fa; }
    h1 { margin-bottom: 10px; }
    label { display: block; margin-top: 10px; font-weight: bold; }
    input, textarea, select { width: 100%; padding: 6px; margin-top: 4px; border: 1px solid #ccc; border-radius: 6px; }
    button { margin-top: 15px; padding: 10px 16px; background: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer; }
    button:hover { background: #0056b3; }
    .section { background: white; padding: 20px; margin-top: 20px; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    textarea { height: 80px; font-family: monospace; }
    .preview { background: #f1f1f1; padding: 12px; border-radius: 6px; margin-top: 15px; white-space: pre-wrap; direction: ltr; }
  </style>
</head>
<body>
  <h1>ğŸ‘¨â€ğŸ’» Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©</h1>

  <div class="section">
    <h3>â• Ø¥Ø¶Ø§ÙØ© Ø£Ùˆ ØªØ­Ø¯ÙŠØ« Ù…Ø¬Ù…ÙˆØ¹Ø© (Menu)</h3>
    <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ¨ÙŠØ± (Ù…Ø«Ø§Ù„: Ù…ÙŠÙ†ÙŠÙˆ 1)</label>
    <input id="mainTitle" placeholder="Ù…Ø«Ø§Ù„: Ù…ÙŠÙ†ÙŠÙˆ 3" />

    <label>Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© (Ù…Ø«Ø§Ù„: fas fa-book)</label>
    <input id="mainIcon" placeholder="Ù…Ø«Ø§Ù„: fas fa-folder" />

    <label>Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ© (Ù…Ø«Ø§Ù„: #e0f7fa)</label>
    <input id="mainColor" placeholder="#d1e7dd" />

    <label>ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¸Ù‡ÙˆØ± (Ø±Ù‚Ù…)</label>
    <input id="mainOrder" type="number" min="1" value="1" />

    <label>Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„ØµØºÙŠØ±Ø© (ÙˆØ§Ø­Ø¯ ÙÙŠ ÙƒÙ„ Ø³Ø·Ø±: Ø§Ù„Ù†Øµ | Ø§Ù„Ø±Ø§Ø¨Ø· | Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© | Ø§Ù„Ù„ÙˆÙ†)</label>
    <textarea id="subItems" placeholder="Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ù„Ù…ÙŠ|/recherche|fas fa-microscope|#336699"></textarea>

    <button onclick="submitUpdate()">âœ¨ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</button>
  </div>

  <div class="section">
    <h3>ğŸ—‘ Ø­Ø°Ù Ù…Ø¬Ù…ÙˆØ¹Ø© ÙƒØ§Ù…Ù„Ø©</h3>
    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© (Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ¨ÙŠØ±)</label>
    <input id="deleteTitle" placeholder="Ù…Ø«Ø§Ù„: Ù…ÙŠÙ†ÙŠÙˆ 2" />
    <button onclick="deleteGroup()">ğŸ—‘ Ø­Ø°Ù</button>
  </div>

  <div class="section">
    <h3>ğŸ” Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ</h3>
    <div class="preview" id="preview"></div>
  </div>

  <script>
    async function loadPreview() {
      const res = await fetch('/api/menu/snippet');
      const html = await res.text();
      document.getElementById('preview').textContent = html;
    }

    async function submitUpdate() {
      const mainTitle = document.getElementById('mainTitle').value.trim();
      const mainIcon = document.getElementById('mainIcon').value.trim();
      const mainColor = document.getElementById('mainColor').value.trim();
      const mainOrder = parseInt(document.getElementById('mainOrder').value);
      const subItemsRaw = document.getElementById('subItems').value.trim();

      const subItems = subItemsRaw.split('\n').map(line => {
        const [text, href, icon, color] = line.split('|').map(s => s.trim());
        return { text, href, icon, color };
      });

      const current = await fetch('/api/menu/snippet').then(r => r.text());

      const instructions = `ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„ØªØ§Ù„ÙŠ Ø¨Ø¥Ø¶Ø§ÙØ© Ø£Ùˆ ØªØ­Ø¯ÙŠØ« Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¨Ø¹Ù†ÙˆØ§Ù† "${mainTitle}" Ø¨ØªØ±ØªÙŠØ¨ ${mainOrder}.
Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ©: ${mainColor}ØŒ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©: ${mainIcon}.
Ø§Ù„Ø¹Ù†Ø§ØµØ±:
${subItems.map(item => `- "${item.text}" | ${item.href} | ${item.icon} | ${item.color}`).join('\n')}
Ø«Ù… Ø¥Ø¹Ø§Ø¯Ø© ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø­Ø³Ø¨ ØªØ±ØªÙŠØ¨Ù‡Ø§ØŒ Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªØ§Ù„ÙŠØ© Ù„ÙƒÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø©:
<div class="sidebar-card" style="background-color:[Ù„ÙˆÙ† Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©]">
  <div class="section-title">
    <i class="[Ø£ÙŠÙ‚ÙˆÙ†Ø©]" style="float:left; margin-right:8px;"></i> [Ø¹Ù†ÙˆØ§Ù†]
  </div>
  <ul>
    <li style="color:[Ù„ÙˆÙ†]">
      <i class="[Ø£ÙŠÙ‚ÙˆÙ†Ø©]" style="float:left; margin-right:6px;"></i> [Ø§Ù„Ù†Øµ]
    </li>
  </ul>
</div>
Ø§Ø­Ø°Ù Ø£ÙŠ Ù…Ø¬Ù…ÙˆØ¹Ø© ØºÙŠØ± Ù…Ø°ÙƒÙˆØ±Ø©.`;

      const finalPrompt = `${current}\n\nØ§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª:\n${instructions}`;

      const res = await fetch('/api/generate-menu', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ prompt: finalPrompt })
      });

      const newCode = await res.text();
      document.getElementById('preview').textContent = newCode;
      alert('âœ… ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­');
    }

    async function deleteGroup() {
      const groupName = document.getElementById('deleteTitle').value.trim();
      const res = await fetch('/api/menu/delete-by-name', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ groupName })
      });
      const data = await res.json();
      alert(data.message);
      loadPreview();
    }

    loadPreview();
  </script>
</body>
</html>